/*! Volksoper - v0.0.1 - 2013-01-06
* https://github.com/necoco/volksoper
* Copyright (c) 2013 tshinsay; Licensed MIT */
var volksoper;(function(e){var t=function(){function e(e){this._type=e,this._propagates=!0,this._stopImmediate=!1}return e.ADDED="added",e.REMOVE="remove",e.ADDED_TO_SCENE="addedToScene",e.REMOVE_FROM_SCENE="removeFromScene",e.ADDED_TO_STAGE="addedToStage",e.REMOVE_FROM_STAGE="removeFromStage",e.COMPLETE="complete",e.LOADED="loaded",e.LOADING_FAILED="loadingFailed",e.ENTER_FRAME="enterFrame",Object.defineProperty(e.prototype,"type",{get:function(){return this._type},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"propagates",{get:function(){return this._propagates},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"stopImmediate",{get:function(){return this._stopImmediate},enumerable:!0,configurable:!0}),e.prototype._reuse=function(){this._propagates=!0,this._stopImmediate=!1},e.prototype.stopPropagation=function(){this._propagates=!1},e.prototype.stopPropagationImmediate=function(){this._propagates=!1,this._stopImmediate=!0},e}();e.Event=t})(volksoper||(volksoper={}));var volksoper;(function(e){e.SYSTEM_PRIORITY=1e8;var t=function(){function t(){this._forEach=0}return t._handlerNameTable={},Object.defineProperty(t.prototype,"parent",{get:function(){return this._parent},set:function(e){this._parent&&this._parent.removeChild(this),e.addChild(this)},enumerable:!0,configurable:!0}),t.prototype.applyProperties=function(e){if(!e)return;for(var t in e)this[t]=e[t]},t.prototype.addChild=function(t){this._children=this._children||[],t._parent=this,this._children.push(t),t.propagateEvent(new e.Event(e.Event.ADDED))},t.prototype.removeChild=function(t){if(!this._children)return!1;if(this._forEach!==0)return this._toRemove=this._toRemove||[],this._toRemove.push(t),!0;var n=this._children.indexOf(t);return n>=0?(t.propagateEvent(new e.Event(e.Event.REMOVE)),this._children.splice(n,1),t._parent=null,!0):!1},t.prototype.popChild=function(){var t=this.topChild;return t?(t.propagateEvent(new e.Event(e.Event.REMOVE)),this._children.pop(),t._parent=null,t):null},t.prototype.swapTop=function(e){var t=this.popChild();return t&&this.addChild(e),t},Object.defineProperty(t.prototype,"topChild",{get:function(){return!this._children||this._children.length===0?null:this._children[this._children.length-1]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"numChildren",{get:function(){return this._children?this._children.length:0},enumerable:!0,configurable:!0}),t.prototype.sortChildren=function(e){this._children=this._children||[],this._children.sort(e)},t.prototype.getChild=function(e){return this._children?this._children[e]:null},t.prototype.addEventListener=function(e,n,r,i){r?this._captureHandlers=t._registerListener(this._captureHandlers,e,n,i):this._bubbleHandlers=t._registerListener(this._bubbleHandlers,e,n,i)},t.prototype.removeEventListener=function(e,n,r){return r?t._removeHandler(this._captureHandlers,e,n):t._removeHandler(this._bubbleHandlers,e,n)},t._removeHandler=function(t,n,r){if(!t)return!1;var i=t[n];for(var s in i){var o=i[s].handler;if(o===r)return i.splice(s,1),!0}return!1},t._registerListener=function(t,n,r,i){return i=i||0,t=t||{},n in t||(t[n]=[]),t[n].push({priority:i,handler:r}),t[n].sort(function(e,t){return t.priority-e.priority}),t},t.prototype.dispatchEvent=function(e){return this._handleEvent(e,this,!1)},t.prototype.propagateEvent=function(e){var t=!1,n=[this],r=this,i=0;while(r=r._parent)n.push(r);var s=n.length;for(i=s-1;i>=0;i--){t=n[i]._handleEvent(e,this,!0)||t;if(!e.propagates)return t}for(i=0;i<s;i++){t=n[i]._handleEvent(e,this,!1)||t;if(!e.propagates)return t}return t},t.prototype.broadcastEvent=function(e,t){return this._broadcastEvent(e,t?t:this)},t.prototype._broadcastEvent=function(e,t){var n=!1;return n=this._handleEvent(e,t,!1)||n,e.propagates?this.forEachChild(function(r){n=r._broadcastEvent(e,t)||n}):e._reuse(),n},t.prototype.broadcast=function(e){var t=[];for(var n=0;n<arguments.length-1;n++)t[n]=arguments[n+1];e in this&&this[e].call(this,t),this.forEachChild(function(n){n.broadcast(e,t)})},t.prototype.forEachChild=function(e,t){this._forEach++;if(this._children){var n=this._children.length,r=0;if(t){for(r=n-1;r>=0;--r)if(e(this._children[r]))break}else for(r=0;r<n;++r)if(e(this._children[r]))break}this._forEach--;if(this._forEach===0){var i=this._toRemove;if(i){var s=i.length;for(var o=0;o<s;o++)this.removeChild(i[o]);i.splice(0)}}},t.prototype._handleEvent=function(e,t,n){e.currentTarget=this,e.target=t;if(!n&&this._callHandler(e)&&e.stopImmediate)return!0;var r=e.type,i;n&&this._captureHandlers?i=this._captureHandlers[r]:!n&&this._bubbleHandlers&&(i=this._bubbleHandlers[r]);if(!i||i.length===0)return!1;for(var s in i){var o=i[s].handler;e.currentTarget=this,e.target=t,o(e);if(e.stopImmediate)break}return!0},t.prototype._callHandler=function(e){var n=t._handlerNameTable[e.type]||t._getHandlerName(e);return this[n]?(this[n](e),!0):!1},t._getHandlerName=function(n){var r=n.type,i="on"+r.charAt(0).toUpperCase()+r.substr(1);return t._handlerNameTable[r]=i,i},t}();e.Actor=t})(volksoper||(volksoper={}));var volksoper;(function(e){var t=function(){function e(e,t,n){this.x=e,this.y=t,this.z=n,this.x=e||0,this.y=t||0,this.z=n||0}return e.prototype.normalize=function(){var e=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z);return e===0?!1:(this.x/=e,this.y/=e,this.z/=e,!0)},e.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},e.prototype.dot=function(e){return this.x*e.x+this.y*e.y+this.z*e.z},e.prototype.cross=function(e,t){return this.x=e.y*t.z-e.z*t.y,this.y=e.z*t.x-e.x*t.z,this.z=e.x*t.y-e.y*t.x,this},e}();e.Vector3=t})(volksoper||(volksoper={}));var volksoper;(function(e){var t=function(){function e(e){this.m=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],e&&this.setValue(e)}return e.IDENT=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],e.TMP=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],e.TMP_MAT=new e,e.prototype.setValue=function(e){var t=this.m,n=e.m;for(var r=0;r<16;++r)t[r]=n[r]},e.prototype.translate=function(e,t,n){var r=this.m;return r[12]+=e,r[13]+=t,r[14]+=n,this},e.prototype.rotate=function(t,n,r){var i=e.TMP_MAT.m;e.TMP_MAT.identify();var s=Math.cos(t),o=Math.cos(n),u=Math.cos(r),a=Math.sin(t),f=Math.sin(n),l=Math.sin(r);return i[0]=o*u,i[1]=a*f*u-s*l,i[2]=s*f*u+a*l,i[4]=o*l,i[5]=a*f*l+s*u,i[6]=s*f*l-a*u,i[8]=-f,i[9]=a*o,i[10]=s*u,this.multiply(e.TMP_MAT)},e.prototype.multiply=function(t){var n=this.m,r=t.m,i=e.TMP;i[0]=n[0]*r[0]+n[4]*r[1]+n[8]*r[2]+n[12]*r[3],i[4]=n[0]*r[4]+n[4]*r[5]+n[8]*r[6]+n[12]*r[7],i[8]=n[0]*r[8]+n[4]*r[9]+n[8]*r[10]+n[12]*r[11],i[12]=n[0]*r[12]+n[4]*r[13]+n[8]*r[14]+n[12]*r[15],i[1]=n[1]*r[0]+n[5]*r[1]+n[9]*r[2]+n[13]*r[3],i[5]=n[1]*r[4]+n[5]*r[5]+n[9]*r[6]+n[13]*r[7],i[9]=n[1]*r[8]+n[5]*r[9]+n[9]*r[10]+n[13]*r[11],i[13]=n[1]*r[12]+n[5]*r[13]+n[9]*r[14]+n[13]*r[15],i[2]=n[2]*r[0]+n[6]*r[1]+n[10]*r[2]+n[14]*r[3],i[6]=n[2]*r[4]+n[6]*r[5]+n[10]*r[6]+n[14]*r[7],i[10]=n[2]*r[8]+n[6]*r[9]+n[10]*r[10]+n[14]*r[11],i[14]=n[2]*r[12]+n[6]*r[13]+n[10]*r[14]+n[14]*r[15],i[3]=n[3]*r[0]+n[7]*r[1]+n[11]*r[2]+n[15]*r[3],i[7]=n[3]*r[4]+n[7]*r[5]+n[11]*r[6]+n[15]*r[7],i[11]=n[3]*r[8]+n[7]*r[9]+n[11]*r[10]+n[15]*r[11],i[15]=n[3]*r[12]+n[7]*r[13]+n[11]*r[14]+n[15]*r[15];for(var s=0;s<16;++s)n[s]=i[s];return this},e.prototype.multiplyVector=function(e,t){var n=this.m;return t.x=e.x*n[0]+e.y*n[1]+e.z*n[2]+n[3],t.y=e.x*n[4]+e.y*n[5]+e.z*n[6]+n[7],t.z=e.x*n[8]+e.y*n[9]+e.z*n[10]+n[11],t},e.prototype.transpose=function(t){var n=this.m,r=t.m,i=e.TMP;i[0]=r[0],i[4]=r[1],i[8]=r[2],i[12]=r[3],i[1]=r[4],i[5]=r[5],i[9]=r[6],i[13]=r[7],i[2]=r[8],i[6]=r[9],i[10]=r[10],i[14]=r[11],i[3]=r[12],i[7]=r[13],i[11]=r[14],i[15]=r[15];for(var s=0;s<16;++s)n[s]=i[s];return this},e.prototype.identify=function(){var e=this.m;return e[0]=1,e[4]=0,e[8]=0,e[12]=0,e[1]=0,e[5]=1,e[9]=0,e[13]=0,e[2]=0,e[6]=0,e[10]=1,e[14]=0,e[3]=0,e[7]=0,e[11]=0,e[15]=1,this},e.prototype.invert=function(){var t=e.TMP,n=this.m,r=n[3]*n[6]*n[9]*n[12]-n[2]*n[7]*n[9]*n[12]-n[3]*n[5]*n[10]*n[12]+n[1]*n[7]*n[10]*n[12]+n[2]*n[5]*n[11]*n[12]-n[1]*n[6]*n[11]*n[12]-n[3]*n[6]*n[8]*n[13]+n[2]*n[7]*n[8]*n[13]+n[3]*n[4]*n[10]*n[13]-n[0]*n[7]*n[10]*n[13]-n[2]*n[4]*n[11]*n[13]+n[0]*n[6]*n[11]*n[13]+n[3]*n[5]*n[8]*n[14]-n[1]*n[7]*n[8]*n[14]-n[3]*n[4]*n[9]*n[14]+n[0]*n[7]*n[9]*n[14]+n[1]*n[4]*n[11]*n[14]-n[0]*n[5]*n[11]*n[14]-n[2]*n[5]*n[8]*n[15]+n[1]*n[6]*n[8]*n[15]+n[2]*n[4]*n[9]*n[15]-n[0]*n[6]*n[9]*n[15]-n[1]*n[4]*n[10]*n[15]+n[0]*n[5]*n[10]*n[15];if(r===0)return!1;var i=1/r;return t[0]=n[9]*n[14]*n[7]-n[13]*n[10]*n[7]+n[13]*n[6]*n[11]-n[5]*n[14]*n[11]-n[9]*n[6]*n[15]+n[5]*n[10]*n[15],t[4]=n[12]*n[10]*n[7]-n[8]*n[14]*n[7]-n[12]*n[6]*n[11]+n[4]*n[14]*n[11]+n[8]*n[6]*n[15]-n[4]*n[10]*n[15],t[8]=n[8]*n[13]*n[7]-n[12]*n[9]*n[7]+n[12]*n[5]*n[11]-n[4]*n[13]*n[11]-n[8]*n[5]*n[15]+n[4]*n[9]*n[15],t[12]=n[12]*n[9]*n[6]-n[8]*n[13]*n[6]-n[12]*n[5]*n[10]+n[4]*n[13]*n[10]+n[8]*n[5]*n[14]-n[4]*n[9]*n[14],t[1]=n[13]*n[10]*n[3]-n[9]*n[14]*n[3]-n[13]*n[2]*n[11]+n[1]*n[14]*n[11]+n[9]*n[2]*n[15]-n[1]*n[10]*n[15],t[5]=n[8]*n[14]*n[3]-n[12]*n[10]*n[3]+n[12]*n[2]*n[11]-n[0]*n[14]*n[11]-n[8]*n[2]*n[15]+n[0]*n[10]*n[15],t[9]=n[12]*n[9]*n[3]-n[8]*n[13]*n[3]-n[12]*n[1]*n[11]+n[0]*n[13]*n[11]+n[8]*n[1]*n[15]-n[0]*n[9]*n[15],t[13]=n[8]*n[13]*n[2]-n[12]*n[9]*n[2]+n[12]*n[1]*n[10]-n[0]*n[13]*n[10]-n[8]*n[1]*n[14]+n[0]*n[9]*n[14],t[2]=n[5]*n[14]*n[3]-n[13]*n[6]*n[3]+n[13]*n[2]*n[7]-n[1]*n[14]*n[7]-n[5]*n[2]*n[15]+n[1]*n[6]*n[15],t[6]=n[12]*n[6]*n[3]-n[4]*n[14]*n[3]-n[12]*n[2]*n[7]+n[0]*n[14]*n[7]+n[4]*n[2]*n[15]-n[0]*n[6]*n[15],t[10]=n[4]*n[13]*n[3]-n[12]*n[5]*n[3]+n[12]*n[1]*n[7]-n[0]*n[13]*n[7]-n[4]*n[1]*n[15]+n[0]*n[5]*n[15],t[14]=n[12]*n[5]*n[2]-n[4]*n[13]*n[2]-n[12]*n[1]*n[6]+n[0]*n[13]*n[6]+n[4]*n[1]*n[14]-n[0]*n[5]*n[14],t[3]=n[9]*n[6]*n[3]-n[5]*n[10]*n[3]-n[9]*n[2]*n[7]+n[1]*n[10]*n[7]+n[5]*n[2]*n[11]-n[1]*n[6]*n[11],t[7]=n[4]*n[10]*n[3]-n[8]*n[6]*n[3]+n[8]*n[2]*n[7]-n[0]*n[10]*n[7]-n[4]*n[2]*n[11]+n[0]*n[6]*n[11],t[11]=n[8]*n[5]*n[3]-n[4]*n[9]*n[3]-n[8]*n[1]*n[7]+n[0]*n[9]*n[7]+n[4]*n[1]*n[11]-n[0]*n[5]*n[11],t[15]=n[4]*n[9]*n[2]-n[8]*n[5]*n[2]+n[8]*n[1]*n[6]-n[0]*n[9]*n[6]-n[4]*n[1]*n[10]+n[0]*n[5]*n[10],n[0]=t[0]*i,n[4]=t[4]*i,n[8]=t[8]*i,n[12]=t[12]*i,n[1]=t[1]*i,n[5]=t[5]*i,n[9]=t[9]*i,n[13]=t[13]*i,n[2]=t[2]*i,n[6]=t[6]*i,n[10]=t[10]*i,n[14]=t[14]*i,n[3]=t[3]*i,n[7]=t[7]*i,n[11]=t[11]*i,n[15]=t[15]*i,!0},e.prototype.determinant=function(){var e=this.m;return e[3]*e[6]*e[9]*e[12]-e[2]*e[7]*e[9]*e[12]-e[3]*e[5]*e[10]*e[12]+e[1]*e[7]*e[10]*e[12]+e[2]*e[5]*e[11]*e[12]-e[1]*e[6]*e[11]*e[12]-e[3]*e[6]*e[8]*e[13]+e[2]*e[7]*e[8]*e[13]+e[3]*e[4]*e[10]*e[13]-e[0]*e[7]*e[10]*e[13]-e[2]*e[4]*e[11]*e[13]+e[0]*e[6]*e[11]*e[13]+e[3]*e[5]*e[8]*e[14]-e[1]*e[7]*e[8]*e[14]-e[3]*e[4]*e[9]*e[14]+e[0]*e[7]*e[9]*e[14]+e[1]*e[4]*e[11]*e[14]-e[0]*e[5]*e[11]*e[14]-e[2]*e[5]*e[8]*e[15]+e[1]*e[6]*e[8]*e[15]+e[2]*e[4]*e[9]*e[15]-e[0]*e[6]*e[9]*e[15]-e[1]*e[4]*e[10]*e[15]+e[0]*e[5]*e[10]*e[15]},e.prototype.projection=function(e,t,n,r){var i=this.m;this.identify();var s=1/Math.tan(n*(Math.PI/180)/2),o=(t+e)/(e-t),u=2*t*e/(e-t);return i[0]=s/r,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=s,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=o,i[11]=-1,i[12]=0,i[13]=0,i[14]=u,i[15]=0,this},e.prototype.viewport=function(e,t){var n=this.m;return this.identify(),n[0]=e/2,n[5]=-t/2,n[12]=e/2,n[13]=t/2,this},e.prototype.ortho=function(e,t,n,r,i,s){var o=this.m;this.identify();var u=2/(t-e),a=2/(r-n),f=-2/(s-i),l=-(t+e)/(t-e),c=-(r+n)/(r-n),h=-(s+i)/(s-i);o[0]=u,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=a,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=f,o[11]=0,o[12]=l,o[13]=c,o[14]=h,o[15]=1},e.prototype.scale=function(e,t,n){var r=this.m;return r[0]*=e,r[5]*=t,r[10]*=n,this},e}();e.Matrix4=t})(volksoper||(volksoper={}));var __extends=this.__extends||function(e,t){function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n},volksoper;(function(e){var t=function(t){function n(){var n=this;t.call(this),this._dirtyFlag=!0,this._localMatrix=new e.Matrix4,this._hitArea=!1,this.alpha=1,this.touchEnabled=!0,this._x=0,this._y=0,this._z=0,this._rotation=0,this._rotationX=0,this._rotationY=0,this._scaleX=1,this._scaleY=1,this.visible=!0,this.addEventListener(e.Event.ADDED_TO_STAGE,function(e){n._stage=e.target,n._setStage()},!1,e.SYSTEM_PRIORITY),this.addEventListener(e.Event.REMOVE_FROM_STAGE,function(e){n._unsetStage(),n._stage=null},!1,e.SYSTEM_PRIORITY)}return __extends(n,t),Object.defineProperty(n.prototype,"_dirty",{get:function(){return this._dirtyFlag},set:function(e){this._dirtyFlag=e},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"stage",{get:function(){return this._stage},enumerable:!0,configurable:!0}),n.prototype._setStage=function(){},n.prototype._unsetStage=function(){},Object.defineProperty(n.prototype,"localMatrix",{get:function(){var e=this._localMatrix;if(this._dirty){this._dirty=!1;var t=this.pivotX||0,n=this.pivotY||0;e.identify().translate(t+this.x,n+this.y,this.z).rotate(this.rotationX,this.rotationY,this.rotation).scale(this.scaleX,this.scaleY,1).translate(-t,-n,0)}return e},enumerable:!0,configurable:!0}),n.prototype._visitRendering=function(e){e.visitDisplayObject(this)},n.prototype.hitTestLocal=function(e,t){return!this.width||!this.height?!1:this._hitArea?this._left<=e&&e<=this._right&&this._top<=t&&t<=this._bottom:0<=e&&e<=this.width&&0<=t&&t<=this.height},n.prototype.setHitArea=function(e,t,n,r){this._hitArea=!0,this._left=e,this._top=t,this._right=n,this._bottom=r},n.prototype.clearHitArea=function(){this._hitArea=!1},n.prototype.hitTest=function(e,t){var n=this.globalToLocal(e,t);return this.hitTestLocal(n.x,n.y)},n.prototype.getWorldMatrix=function(t){var n=this.parent;return t||(t=new e.Matrix4),n&&n.getWorldMatrix&&n.getWorldMatrix(t),t.multiply(this.localMatrix),t},n.prototype.globalToLocal=function(e,t){var n=this.getWorldMatrix(),r=n.m;return n.invert()?{x:e*r[0]+t*r[4]+r[12],y:e*r[1]+t*r[5]+r[13]}:{x:e,y:t}},Object.defineProperty(n.prototype,"x",{get:function(){return this._x},set:function(e){this._x=e,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"y",{get:function(){return this._y},set:function(e){this._y=e,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"z",{get:function(){return this._z},set:function(e){this._z=e,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"pivotX",{get:function(){return this._pivotX},set:function(e){this._pivotX=e,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"pivotY",{get:function(){return this._pivotY},set:function(e){this._pivotY=e,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"rotation",{get:function(){return this._rotation},set:function(e){this._rotation=e,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"rotationX",{get:function(){return this._rotationX},set:function(e){this._rotationX=e,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"rotationY",{get:function(){return this._rotationY},set:function(e){this._rotationY=e,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"scaleX",{get:function(){return this._scaleX},set:function(e){this._scaleX=e,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"scaleY",{get:function(){return this._scaleY},set:function(e){this._scaleY=e,this._dirty=!0},enumerable:!0,configurable:!0}),n}(e.Actor);e.DisplayActor=t})(volksoper||(volksoper={}));var volksoper;(function(e){(function(t){function n(e,t,n,r){return n*e/r+t}function r(e,t,n,r){return n*(.5-Math.cos(e/r*Math.PI)/2)+t}function i(e,t,n,r){return n*(e/=r)*e+t}function s(e,t,n,r){return-n*(e/=r)*(e-2)+t}function o(e,t,n,r){return(e/=r/2)<1?n/2*e*e+t:-n/2*(--e*(e-2)-1)+t}function u(e,t,n,r){return n*(e/=r)*e*e+t}function a(e,t,n,r){return n*((e=e/r-1)*e*e+1)+t}function f(e,t,n,r){return(e/=r/2)<1?n/2*e*e*e+t:n/2*((e-=2)*e*e+2)+t}function l(e,t,n,r){return n*(e/=r)*e*e*e+t}function c(e,t,n,r){return-n*((e=e/r-1)*e*e*e-1)+t}function h(e,t,n,r){return(e/=r/2)<1?n/2*e*e*e*e+t:-n/2*((e-=2)*e*e*e-2)+t}function p(e,t,n,r){return n*(e/=r)*e*e*e*e+t}function d(e,t,n,r){return n*((e=e/r-1)*e*e*e*e+1)+t}function v(e,t,n,r){return(e/=r/2)<1?n/2*e*e*e*e*e+t:n/2*((e-=2)*e*e*e*e+2)+t}function m(e,t,n,r){return-n*Math.cos(e/r*(Math.PI/2))+n+t}function g(e,t,n,r){return n*Math.sin(e/r*(Math.PI/2))+t}function y(e,t,n,r){return-n/2*(Math.cos(Math.PI*e/r)-1)+t}function b(e,t,n,r){return-n*(Math.sqrt(1-(e/=r)*e)-1)+t}function w(e,t,n,r){return n*Math.sqrt(1-(e=e/r-1)*e)+t}function E(e,t,n,r){return(e/=r/2)<1?-n/2*(Math.sqrt(1-e*e)-1)+t:n/2*(Math.sqrt(1-(e-=2)*e)+1)+t}function S(e,t,n,r){if(e===0)return t;if((e/=r)===1)return t+n;var i=r*.3,s=n,o=i/4;return-(s*Math.pow(2,10*(e-=1))*Math.sin((e*r-o)*2*Math.PI/i))+t}function x(e,t,n,r){if(e===0)return t;if((e/=r)===1)return t+n;var i=r*.3,s=n,o=i/4;return s*Math.pow(2,-10*e)*Math.sin((e*r-o)*2*Math.PI/i)+n+t}function T(e,t,n,r){if(e===0)return t;if((e/=r/2)===2)return t+n;var i=r*.3*1.5,s=n,o=i/4;return e<1?-0.5*s*Math.pow(2,10*(e-=1))*Math.sin((e*r-o)*2*Math.PI/i)+t:s*Math.pow(2,-10*(e-=1))*Math.sin((e*r-o)*2*Math.PI/i)*.5+n+t}function N(t,n,r,i){return r-e.Easing.BOUNCE_EASEOUT(i-t,0,r,i)+n}function C(e,t,n,r){return(e/=r)<1/2.75?n*7.5625*e*e+t:e<2/2.75?n*(7.5625*(e-=1.5/2.75)*e+.75)+t:e<2.5/2.75?n*(7.5625*(e-=2.25/2.75)*e+.9375)+t:n*(7.5625*(e-=2.625/2.75)*e+.984375)+t}function k(t,n,r,i){return t<i/2?e.Easing.BOUNCE_EASEIN(t*2,0,r,i)*.5+n:e.Easing.BOUNCE_EASEOUT(t*2-i,0,r,i)*.5+r*.5+n}function L(e,t,n,r){var i=1.70158;return n*(e/=r)*e*((i+1)*e-i)+t}function A(e,t,n,r){var i=1.70158;return n*((e=e/r-1)*e*((i+1)*e+i)+1)+t}function O(e,t,n,r){var i=1.70158;return(e/=r/2)<1?n/2*e*e*(((i*=1.525)+1)*e-i)+t:n/2*((e-=2)*e*(((i*=1.525)+1)*e+i)+2)+t}function M(e,t,n,r){return e===0?t:n*Math.pow(2,10*(e/r-1))+t}function _(e,t,n,r){return e===r?t+n:n*(-Math.pow(2,-10*e/r)+1)+t}function D(e,t,n,r){return e===0?t:e===r?t+n:(e/=r/2)<1?n/2*Math.pow(2,10*(e-1))+t:n/2*(-Math.pow(2,-10*--e)+2)+t}t.LINEAR=n,t.SWING=r,t.QUAD_EASEIN=i,t.QUAD_EASEOUT=s,t.QUAD_EASEINOUT=o,t.CUBIC_EASEIN=u,t.CUBIC_EASEOUT=a,t.CUBIC_EASEINOUT=f,t.QUART_EASEIN=l,t.QUART_EASEOUT=c,t.QUART_EASEINOUT=h,t.QUINT_EASEIN=p,t.QUINT_EASEOUT=d,t.QUINT_EASEINOUT=v,t.SIN_EASEIN=m,t.SIN_EASEOUT=g,t.SIN_EASEINOUT=y,t.CIRC_EASEIN=b,t.CIRC_EASEOUT=w,t.CIRC_EASEINOUT=E,t.ELASTIC_EASEIN=S,t.ELASTIC_EASEOUT=x,t.ELASTIC_EASEINOUT=T,t.BOUNCE_EASEIN=N,t.BOUNCE_EASEOUT=C,t.BOUNCE_EASEINOUT=k,t.BACK_EASEIN=L,t.BACK_EASEOUT=A,t.BACK_EASEINOUT=O,t.EXPO_EASEIN=M,t.EXPO_EASEOUT=_,t.EXPO_EASEINOUT=D})(e.Easing||(e.Easing={}));var t=e.Easing})(volksoper||(volksoper={}));var volksoper;(function(e){function n(e){var n=e.engine;if(typeof n=="string")return new t[n](e);for(var r=0,i=n.length;r<i;r++)try{return new t[n](e)}catch(s){}return null}function r(e,n){t[e]=n}var t={};e.createStage=n,e._registerEngine=r})(volksoper||(volksoper={}));var volksoper;(function(e){var t=function(){function t(t,n){this._name=t,this._listeners=[],this._usable=!1,this._fired=!1,this._referenceCount=0,t||(this._name=e.generateUniqueName(n))}return Object.defineProperty(t.prototype,"usable",{get:function(){return this._usable},enumerable:!0,configurable:!0}),t.prototype._setUsable=function(){if(!this._usable){this._usable=!0;for(var e=0;e<this._listeners.length;++e)this._listeners[e](this);this._listeners=null}},t.prototype._fireUsable=function(){if(this._listeners){for(var e=0;e<this._listeners.length;++e)this._listeners[e](this);this._usable=!0,this._fired=!0}},t.prototype._setError=function(){for(var e=0;e<this._listeners.length;++e)this._listeners[e](null);this._usable=!1,this._listeners=null},t.prototype.addUsableListener=function(e){this._listeners&&!this._fired?this._listeners.push(e):this._usable?e(this):e(null)},t.prototype.addRef=function(){return++this._referenceCount},t.prototype.release=function(){return--this._referenceCount},t.prototype.name=function(){return this._name},t}();e.ResourceImpl=t;var n=function(){function e(){}return e.prototype._getImpl=function(){return this._impl},e.prototype.addRef=function(){return this._impl.addRef()},e.prototype.release=function(){return this._impl.release()},Object.defineProperty(e.prototype,"name",{get:function(){return this._impl.name()},enumerable:!0,configurable:!0}),e.prototype.addUsableListener=function(e){this._impl?this._impl.addUsableListener(e):(this._listeners=this._listeners||[],this._listeners.push(e))},e.prototype._setStage=function(e){if(!this._impl){this._impl=this._createImpl(e);if(this._listeners){for(var t=0;t<this._listeners.length;++t)this._impl.addUsableListener(this._listeners[t]);this._listeners=null}}},e.prototype.applyProperties=function(e){if(!e)return;for(var t in e)this[t]=e[t]},e.prototype._createImpl=function(e){throw new Error("unimplemented")},e}();e.Resource=n})(volksoper||(volksoper={}));var volksoper;(function(e){var t=function(t){function n(e,n,r,i){t.call(this,e),this._x=n,this._y=r,this._id=i}return __extends(n,t),n.TOUCH_END="touchEnd",n.TOUCH_START="touchStart",n.TOUCH_MOVE="touchMove",n.TOUCH_CANCEL="touchCancel",Object.defineProperty(n.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"localX",{get:function(){return this._localPosition?this._localPosition.x:this._getLocal().x},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"localY",{get:function(){return this._localPosition?this._localPosition.y:this._getLocal().y},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0}),n.prototype._getLocal=function(){return this._currentTarget instanceof e.DisplayActor?this._localPosition=this._currentTarget.globalToLocal(this._x,this._y):this._localPosition={x:this._x,y:this._y},this._localPosition},Object.defineProperty(n.prototype,"currentTarget",{get:function(){return this._currentTarget},set:function(e){this._currentTarget=e,this._localPosition=null},enumerable:!0,configurable:!0}),n}(e.Event);e.TouchEvent=t})(volksoper||(volksoper={}));var volksoper;(function(e){var t=function(e){function t(t,n,r){e.call(this,t),this._keyCode=n,this._keyName=r}return __extends(t,e),t.KEY_DOWN="keyDown",t.KEY_UP="keyUp",Object.defineProperty(t.prototype,"keyCode",{get:function(){return this._keyCode},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"keyName",{get:function(){return this._keyName},enumerable:!0,configurable:!0}),t}(e.Event);e.KeyEvent=t})(volksoper||(volksoper={}));var volksoper;(function(e){var t=function(){function e(){}return e.prototype.visitDisplayObject=function(e){},e.prototype.visitSprite=function(e){this.visitDisplayObject(e)},e.prototype.visitScene=function(e){this.visitDisplayObject(e)},e.prototype.visitStage=function(e){this.visitDisplayObject(e)},e.prototype.visitSceneNode=function(e){this.visitDisplayObject(e)},e}();e.RenderingVisitor=t})(volksoper||(volksoper={}));var volksoper;(function(e){var t=function(t){function n(n){t.call(this),this._running=!0,this.updateByFrame=!1,this._currentTime=0,this._leftTime=0,this._deltaTime=0,this._loop=!1,this._backgroundColor=16777215,this._touchReceivers={},n.width=n.width||320,n.height=n.height||320,n.scale=n.scale||1,n.keys=n.keys||{},n.loop===undefined&&(n.loop=!0);var r=this,i=function(t){t.target.broadcastEvent(new e.Event(e.Event.ADDED_TO_STAGE),r)},s=function(t){t.target.broadcastEvent(new e.Event(e.Event.REMOVE_FROM_STAGE),r)};this.addEventListener(e.Event.ADDED,i,!0,e.SYSTEM_PRIORITY),this.addEventListener(e.Event.REMOVE,s,!0,e.SYSTEM_PRIORITY),this.applyProperties(n),this.addChild(new e.Scene)}return __extends(n,t),Object.defineProperty(n.prototype,"running",{get:function(){return this._running},enumerable:!0,configurable:!0}),n.prototype.suspend=function(){this._running=!1},n.prototype.resume=function(){this._running=!0},Object.defineProperty(n.prototype,"deltaTime",{get:function(){return this._deltaTime},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"loop",{get:function(){return this._loop},set:function(e){this._loop=e},enumerable:!0,configurable:!0}),n.prototype.addChild=function(n){if(!(n instanceof e.Scene))throw Error("Stage can hold Scene only.");t.prototype.addChild.call(this,n)},n.prototype.render=function(){throw new Error("unimplemented")},Object.defineProperty(n.prototype,"width",{get:function(){return this._width},set:function(e){this._width=e,this._adjustStage()},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"backgroundColor",{get:function(){return this._backgroundColor},set:function(e){this._backgroundColor=e},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"height",{get:function(){return this._height},set:function(e){this._height=e,this._adjustStage()},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"fps",{get:function(){return this._fps},set:function(e){this._fps=e},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"scale",{get:function(){return this._scale},set:function(e){this._scale=e},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"autoScale",{get:function(){return this._autoScale},set:function(e){this._autoScale=e,e&&(this._autoSize=!1),this._adjustStage()},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"fullScreen",{get:function(){return this._fullScreen},set:function(e){this._fullScreen=e,this._adjustStage()},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"autoSize",{get:function(){return this._autoSize},set:function(e){this._autoSize=e,e&&(this._autoScale=!1),this._adjustStage()},enumerable:!0,configurable:!0}),n.prototype._adjustStage=function(){},Object.defineProperty(n.prototype,"keys",{get:function(){return this._keyMap},set:function(e){this._keyMap=e},enumerable:!0,configurable:!0}),n.prototype.registerTouchReceiver=function(e,t){this._touchReceivers[t]=e},n.prototype.unregisterTouchReceiver=function(e){delete this._touchReceivers[e]},n.prototype.propagateTouchEvent=function(t,n,r,i){var s=this._touchReceivers[i];return s||(s=this._findTouch(this.topChild,n,r)),s?s.propagateEvent(new e.TouchEvent(t,n,r,i)):this.dispatchEvent(new e.TouchEvent(t,n,r,i)),s},n.prototype.broadcastKeyEvent=function(t,n,r){this.topChild.broadcastEvent(new e.KeyEvent(t,n,r))},n.prototype._findTouch=function(t,n,r){var i=this,s=null;return t.touchEnabled?(t.forEachChild(function(e){return s=i._findTouch(e,n,r),s},!0),s?s:t instanceof e.DisplayActor?t.hitTest(n,r)?t:null:null):null},n.prototype._render=function(e,t,n){if(!this.visible)return;this._innerRender(this.topChild,e,t,n)},n.prototype._innerRender=function(e,t,n,r){var i=this;if(!e.visible)return;e._visitRendering(t),e._visitRendering(n),e.forEachChild(function(e){i._innerRender(e,t,n,r)}),e._visitRendering(r)},n.prototype._createSceneDock=function(){throw new Error("unimplemented")},n.prototype._visitRendering=function(e){e.visitStage(this)},Object.defineProperty(n.prototype,"currentScene",{get:function(){return this.topChild},enumerable:!0,configurable:!0}),n.prototype.changeScene=function(e){this.popChild(),this.addChild(e)},n.prototype.pushScene=function(e){this.addChild(e)},n.prototype.popScene=function(){this.popChild()},n.prototype.invalidate=function(){var t=this;this._currentTime===0&&(this._currentTime=(new Date).getTime());var n=(new Date).getTime()-this._currentTime;this._currentTime+=n;var r=1e3/this.fps,i=!1;if(this.fps){var s=n+this._leftTime,o=0;this._deltaTime=r;while(s>=r)this.broadcastEvent(new e.Event(e.Event.ENTER_FRAME)),s-=r,o++;this.updateByFrame?i=this.currentScene.storyBoard.update(o):i=this.currentScene.storyBoard.update(n/1e3),this._leftTime=s}else this._deltaTime=n/1e3,r=1e3/60,this.broadcastEvent(new e.Event(e.Event.ENTER_FRAME)),this.updateByFrame?i=this.currentScene.storyBoard.update(1):i=this.currentScene.storyBoard.update(this._deltaTime);this.render(),(this.loop||i)&&this._nextFrame(function(){t.invalidate()},r)},n.prototype._nextFrame=function(e,t){throw new Error("unimplemented")},n}(e.DisplayActor);e.Stage=t})(volksoper||(volksoper={}));var volksoper;(function(e){function n(e){return"volksoper-"+e+"-"+(++t).toString()}function r(e){var t=e.match(/\.\w+$/);return t&&t.length>0?t[0].slice(1).toLowerCase():null}function i(e){var t=e.toString(16);for(var n=t.length;n<6;++n)t="0"+t;return t="#"+t,t}var t=0;e.generateUniqueName=n,e.extractExt=r,e.toCSSColor=i})(volksoper||(volksoper={}));var volksoper;(function(e){var t=function(e){function t(){e.apply(this,arguments)}return __extends(t,e),t.prototype.invalidate=function(){},t.prototype.render=function(){},t.prototype.width=function(){throw new Error("unimplemented")},t.prototype.height=function(){throw new Error("unimplemented")},t.prototype.clearCache=function(){},t}(e.ResourceImpl);e.SurfaceImpl=t;var n=function(e){function t(t,n,r,i,s){e.call(this),this._width=t,this._height=n,this._renderer=r,this._primitive=i,this._name=s,this._invalidate=!1,this._renderer&&(this._invalidate=!0)}return __extends(t,e),t.prototype.invalidate=function(){if(!this._impl){this._invalidate=!0;return}this._impl.invalidate()},Object.defineProperty(t.prototype,"width",{get:function(){return this._impl.width()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this._impl.height()},enumerable:!0,configurable:!0}),t.prototype._render=function(){this._impl&&this._impl.render()},t.prototype._clearCache=function(){this._impl&&this._impl.clearCache()},t.prototype._setStage=function(t){e.prototype._setStage.call(this,t),this._invalidate&&(this._invalidate=!1,this._impl.invalidate())},t.prototype._createImpl=function(e){return e.currentScene.dock._createSurfaceImpl(this._width,this._height,this._renderer,this._primitive,this._name)},t.prototype.hitTestLocal=function(e,t){return 0<=e&&e<=this.width&&0<=t&&t<=this.height},t}(e.Resource);e.Surface=n})(volksoper||(volksoper={}));var volksoper;(function(e){var t=function(e){function t(){e.apply(this,arguments)}return __extends(t,e),t}(e.SurfaceImpl);e.ImageImpl=t;var n=function(e){function t(t){e.call(this,0,0),this._src=t}return __extends(t,e),t.prototype._createImpl=function(e){return e.currentScene.dock._createImageImpl(this._src)},t}(e.Surface);e.Image=n})(volksoper||(volksoper={}));var volksoper;(function(e){var t=function(e){function t(){e.apply(this,arguments)}return __extends(t,e),t.prototype.text=function(e){throw new Error("unimplemented")},t.prototype.align=function(e){throw new Error("unimplemented")},t.prototype.lineGap=function(e){throw new Error("unimplemented")},t.prototype.textColor=function(e){throw new Error("unimplemented")},t.prototype.font=function(e){throw new Error("unimplemented")},t}(e.SurfaceImpl);e.LabelImpl=t;var n=function(e){function t(t,n,r){e.call(this,t,n,null,!1,null),this._width=t,this._height=n,this._align=0,this._lineGap=0,this._textColor=0,this.applyProperties(r)}return __extends(t,e),Object.defineProperty(t.prototype,"font",{get:function(){return this._font},set:function(e){this._font=e,this._impl&&this._impl.font(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"align",{get:function(){return this._align},set:function(e){this._align=e,this._impl&&this._impl.align(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"lineGap",{get:function(){return this._lineGap},set:function(e){this._lineGap=e,this._impl&&this._impl.lineGap(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"textColor",{get:function(){return this._textColor},set:function(e){this._textColor=e,this._impl&&this._impl.textColor(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"text",{get:function(){return this._text},set:function(e){this._text=e,this._impl&&this._impl.text(e)},enumerable:!0,configurable:!0}),t.prototype._setStage=function(t){e.prototype._setStage.call(this,t),this._impl.font(this._font),this._impl.lineGap(this._lineGap),this._impl.align(this._align),this._impl.text(this._text),this._impl.textColor(this._textColor)},t.prototype._createImpl=function(e){return e.currentScene.dock._createLabelImpl(this._width,this._height,this._name)},t}(e.Surface);e.Label=n;var r=function(){function e(e,t,n,r){this.size=e,this.bold=t,this.italic=n,this.face=r}return e}();e.Font=r,function(e){e.CENTER=1,e.LEFT=2,e.RIGHT=4}(e.HorizontalAlign||(e.HorizontalAlign={}));var i=e.HorizontalAlign;(function(e){e.CENTER=16,e.TOP=32,e.BOTTOM=64})(e.VerticalAlign||(e.VerticalAlign={}));var s=e.VerticalAlign})(volksoper||(volksoper={}));var volksoper;(function(e){function t(e){var t=[];return function(n,r){if(r)return t.push(r),!1;while(t.length!==0){if(t[0](n))return!0;t.shift()}return e&&e(),!1}}function n(e){return function(){e()}}function r(){var e=[];return function(t,n){if(n)return e.push(n),!1;for(var r=0;r<e.length;++r)e[r](t)||(e.splice(r,1),r-=1);return e.length!==0}}function i(e,t){var n=!1,r=function(i){t.removeEventListener(e,r),n=!0};return t.addEventListener(e,r),function(){return!n}}function s(e,t,n,r){var i={},s=0;for(var o in t)i[o]=e[o];return function(o){var u=o.consume(n-s),a=null;if(u>=0){s+=u;for(a in t)e[a]=r(s,i[a],t[a]-i[a],n);return!0}for(a in t)e[a]=t[a];return!1}}function o(e){return function(){return e(),!1}}var u=function(){function u(e,t){this._board=e,this._hero=t,this._state="normal"}return u.prototype._createScenario=function(){var e=this;this._scenario||(this._board&&this._board._registerStory(this),this._scenario=t(function(){e._scenario=null,e._board._unregisterStory(e)}))},u.prototype._attachStoryBoard=function(e){this._board=e,e._registerStory(this)},u.prototype._addScenario=function(e){this._createScenario();switch(this._state){case"normal":this._scenario(null,e);break;case"and":this._and(null,e),this._state="unknown";break;case"unknown":this._scenario(null,e),this._state="normal"}},u.prototype.wait=function(){var t=r();for(var s=0;s<arguments.length;++s){var o=arguments[s];typeof o=="string"?t(null,i(o,this._hero)):o instanceof e.Story?t(null,o._scenario):t(null,n(o))}return this._addScenario(t),this},u.prototype.then=function(e){return this._addScenario(o(e)),this},u.prototype.waitEvent=function(e,t){return this._addScenario(i(e,t)),this},u.prototype._createTween=function(t,n,r){var i,o,u;if(r.length===1){var a=r[0];i=a.easing||e.Easing.LINEAR,delete a.easing,u=a.time||1,delete a.time,o=a}else i=r[2]||e.Easing.LINEAR,o={},o[r[0]]=r[1];t&&(o=t(o)),this._addScenario(s(n,o,u,i))},u.prototype.tween=function(e){return this._createTween(null,this._hero,arguments),this},u.prototype.tweenBy=function(e){this._createScenario();var t=this._hero;return this._createTween(function(e){for(var n in e)e[n]=e[n]+t[n];return e},t,arguments),this},u.prototype.call=function(e){var t=[];for(var n=0;n<arguments.length-1;n++)t[n]=arguments[n+1];this._createScenario();var r=this._hero;return this._addScenario(function(){return r[e].apply(r,t),!1}),this},Object.defineProperty(u.prototype,"and",{get:function(){switch(this._state){case"normal":this._and=t(null);break;case"and":break;case"unknown":this._state="and"}return this},enumerable:!0,configurable:!0}),u.prototype._update=function(e){this._scenario(e)},u}();e.Story=u})(volksoper||(volksoper={}));var volksoper;(function(e){var t=function(){function e(){this._time=0}return e.prototype.setTime=function(e){this._time=e},e.prototype.consume=function(e){if(this._time<e){var t=this._time;return this._time=0,t}return this._time-=e,-1},e}(),n=function(){function n(){this._stories=[],this._timer=new t,this._unregister=[]}return n.prototype.update=function(e){this._unregister.splice(0),this._timer.setTime(e);for(var t=0;t<this._stories.length;t++)this._stories[t]._update(this._timer);for(var t=0;t<this._unregister.length;++t)this._stories.splice(this._stories.indexOf(this._unregister[t]),1);return this._stories.length===0},n.prototype._registerStory=function(e){var t=this._unregister.indexOf(e);t>=0?this._unregister.splice(t,0):this._stories.push(e)},n.prototype._unregisterStory=function(e){this._unregister.push(e)},n.prototype.story=function(t){return new e.Story(this,t)},Object.defineProperty(n.prototype,"numStories",{get:function(){return this._stories.length},enumerable:!0,configurable:!0}),n}();e.StoryBoard=n})(volksoper||(volksoper={}));var volksoper;(function(e){var t=function(t){function n(e,n){t.call(this),this._stage=e,this._parentDock=n,this._currentResource=0,this._totalResource=0,this._resourcePool={},this._implPool={},this._soundImplPool={}}return __extends(n,t),Object.defineProperty(n.prototype,"stage",{get:function(){return this._stage},enumerable:!0,configurable:!0}),n.prototype.load=function(){var e=[];for(var t=0;t<arguments.length-0;t++)e[t]=arguments[t+0];var n=e.length;this._totalResource+=n;for(var r=0;r<n;++r)this._loadResource(e[r])},n.prototype._releaseResource=function(){for(var e in this._soundImplPool){var t=this._soundImplPool[e];t.release()}this._soundImplPool={}},n.prototype._loadResource=function(t){var n=e.extractExt(t),r=null;switch(n){case"jpg":case"png":case"jpeg":case"gif":r=new e.Image(t),r.addUsableListener(this._createListener());break;case"snd":case"mp3":case"ogg":case"wav":r=new e.Sound(t),r.attach(this.stage),r.addUsableListener(this._createListener())}return this._resourcePool[t]=r,r},n.prototype._createListener=function(){var t=this;return function(n){n?(t.broadcastEvent(new e.Event(e.Event.LOADED),n),t._currentResource++,t._currentResource>=t._totalResource&&t.broadcastEvent(new e.Event(e.Event.COMPLETE))):t.broadcastEvent(new e.Event(e.Event.LOADING_FAILED))}},n.prototype.sound=function(e){return this._resourcePool[e]},n.prototype.image=function(e){return this._resourcePool[e]},n.prototype._findResource=function(e){var t=this._resourcePool[e];return t?t:this._parentDock?this._parentDock._findResource(e):null},n.prototype._createImageImpl=function(e){var t=this._findImpl(e);return t?t:(t=this._newImageImpl(e),this._implPool[e]=t,t)},n.prototype._newImageImpl=function(e){throw new Error("unimplemented")},n.prototype._createSoundImpl=function(e,t){var n=this._findSoundImpl(e);return n?n:(n=this._newSoundImpl(e,t),this._soundImplPool[e]=n,n)},n.prototype._findSoundImpl=function(e){var t=this._soundImplPool[e];return t?t:this._parentDock?this._parentDock._findSoundImpl(e):null},n.prototype._newSoundImpl=function(e,t){throw new Error("unimplemented")},n.prototype._createSurfaceImpl=function(e,t,n,r,i){var s=this._findImpl(i);return s?s:(s=this._newSurfaceImpl(e,t,n,r,i),this._implPool[s.name()]=s,s)},n.prototype._findImpl=function(e){var t=this._implPool[e];return t?t:this._parentDock?this._parentDock._findImpl(e):null},n.prototype._newSurfaceImpl=function(e,t,n,r,i){throw new Error("unimplemented")},n.prototype._createLabelImpl=function(e,t,n){var r=this._findImpl(n);return r?r:(r=this._newLabelImpl(e,t,n),this._implPool[r.name()]=r,r)},n.prototype._newLabelImpl=function(e,t,n){throw new Error("unimplemented")},n}(e.Actor);e.SceneDock=t})(volksoper||(volksoper={}));var volksoper;(function(e){var t=function(t){function n(n){var r=this;t.call(this),this._registry={},this._execFind=0,this._unregister=[],this._board=new e.StoryBoard,this.addEventListener(e.Event.ADDED,function(t){r._registerTarget(t.target),t.target.broadcastEvent(new e.Event(e.Event.ADDED_TO_SCENE),r)},!0,e.SYSTEM_PRIORITY),this.addEventListener(e.Event.REMOVE,function(t){t.target.broadcastEvent(new e.Event(e.Event.REMOVE_FROM_SCENE),r),r._unregisterTarget(t.target)},!0,e.SYSTEM_PRIORITY),this.applyProperties(n)}return __extends(n,t),Object.defineProperty(n.prototype,"storyBoard",{get:function(){return this._board},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"stage",{get:function(){return this._stage},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"dock",{get:function(){return this._dock},enumerable:!0,configurable:!0}),n.prototype._setStage=function(){this._dock=this.stage._createSceneDock()},n.prototype._unsetStage=function(){this.dock._releaseResource(),this._dock=null},n.prototype.addChild=function(n){if(!(n instanceof e.SceneNode))throw Error("Scene can hold SceneNode only.");t.prototype.addChild.call(this,n)},n.prototype._registerTarget=function(e){this._iterateTable(e,function(t){t.push(e)})},n.prototype._iterateTable=function(e,t){var n=e.constructor.group;if(typeof n=="string")this._callbackGroup(n,t);else if(n instanceof Array)for(var r=0;r<n.length;++r)this._callbackGroup(n[r],t)},n.prototype._callbackGroup=function(e,t){var n=this._registry[e];n||(this._registry[e]=n=[]),t(n)},n.prototype._unregisterTarget=function(e){var t=this;this._execFind===0?this._iterateTable(e,function(t){t.splice(t.indexOf(e),1)}):this._iterateTable(e,function(n){t._unregister=[n,e]})},n.prototype.find=function(e,t){this._execFind++,this._callbackGroup(e,function(e){var n=e.length;for(var r=0;r<n;++r)t(e[r])}),this._execFind--;if(this._execFind===0){var n=this._unregister,r=n.length;for(var i=0;i<r;++i)n[i][0].splice(n[i][0].indexOf(n[i][1]),1);n.splice(0)}},n.prototype._visitRendering=function(e){e.visitScene(this)},n}(e.DisplayActor);e.Scene=t})(volksoper||(volksoper={}));var volksoper;(function(e){var t=function(t){function n(){var n=this;t.call(this),this.addEventListener(e.Event.ADDED_TO_SCENE,function(e){n._scene=e.target,n._story&&n._story._attachStoryBoard(n._scene.storyBoard)},!1,e.SYSTEM_PRIORITY),this.addEventListener(e.Event.REMOVE_FROM_SCENE,function(e){n._scene=null,n._story=null},!1,e.SYSTEM_PRIORITY)}return __extends(n,t),Object.defineProperty(n.prototype,"scene",{get:function(){return this._scene},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"story",{get:function(){return this._story?this._story:(this._scene?this._story=this._scene.storyBoard.story(this):this._story=new e.Story(null,this),this._story)},enumerable:!0,configurable:!0}),n.prototype.addChild=function(e){if(!(e instanceof n))throw Error("SceneNode can hold SceneNode only.");t.prototype.addChild.call(this,e)},n.prototype._visitRendering=function(e){e.visitSceneNode(this)},n}(e.DisplayActor);e.SceneNode=t})(volksoper||(volksoper={}));var volksoper;(function(e){var t=function(e){function t(){e.apply(this,arguments)}return __extends(t,e),t.prototype.play=function(){throw new Error("unimplemented")},t.prototype.pause=function(){throw new Error("unimplemented")},t.prototype.loop=function(e){throw new Error("unimplemented")},t.prototype.stop=function(){throw new Error("unimplemented")},t}(e.ResourceImpl);e.SoundImpl=t;var n=function(e){function t(t,n){e.call(this),this._src=t,this._play=!1,this._loop=!1,n&&this.attach(n)}return __extends(t,e),t.prototype._createImpl=function(e){var t=e.currentScene.dock._createSoundImpl(this._src,this._play);return t.loop(this._loop),t},t.prototype.play=function(){this._impl?this._impl.play():this._play=!0},t.prototype.stop=function(){this._impl?this._impl.stop():this._play=!1},t.prototype.pause=function(){this._impl?this._impl.pause():this._play=!1},Object.defineProperty(t.prototype,"loop",{get:function(){return this._loop},set:function(e){this._impl&&this._impl.loop(e),this._loop=e},enumerable:!0,configurable:!0}),t.prototype.attach=function(e){this._setStage(e),this.addRef()},t}(e.Resource);e.Sound=n})(volksoper||(volksoper={}));var volksoper;(function(e){var t=function(e){function t(t){e.call(this),this.applyProperties(t)}return __extends(t,e),Object.defineProperty(t.prototype,"surface",{get:function(){return this._surface},set:function(e){this.stage?(this._surface&&this._surface.release(),this._surface=e,e._setStage(this.stage),e.addRef()):this._surface=e},enumerable:!0,configurable:!0}),t.prototype._setStage=function(){this._surface&&(this._surface._setStage(this.stage),this._surface.addRef())},t.prototype._unsetStage=function(){this._surface&&this._surface.release()},Object.defineProperty(t.prototype,"_dirty",{get:function(){return this._dirtyFlag},set:function(e){this._dirtyFlag=e,this.surface&&e&&this.surface._clearCache()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"width",{get:function(){return this._surface?this._surface.width:0},set:function(e){},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this._surface?this._surface.height:0},set:function(e){},enumerable:!0,configurable:!0}),t.prototype._visitRendering=function(e){e.visitSprite(this)},t}(e.SceneNode);e.Sprite=t})(volksoper||(volksoper={}));var volksoper;(function(e){var t=function(t){function n(n,r){var i=this;t.call(this,n),this._src=n;var s=e.extractExt(n),o=document.createElement("audio");o.autoplay=!1,o.onerror=function(){i._setError()};if(s==="snd"){var u=n.slice(0,n.length-4),a=e.Platform.instance().getPlayableSoundFormat();o.appendChild(this._createSource(u+a,"audio/"+a))}else o.appendChild(this._createSource(n,"audio/"+s));o.load(),r&&o.play(),this._element=o,this._fireUsable()}return __extends(n,t),n.prototype.name=function(){return this._src},n.prototype._createSource=function(e,t){var n=document.createElement("source");return n.src=e,n.type=t,n},n.prototype.play=function(){this._element.play()},n.prototype.stop=function(){this._element.pause(),this._element.currentTime=0},n.prototype.pause=function(){this._element.pause()},n.prototype.loop=function(e){this._element.loop=e},n}(e.SoundImpl);e.DOMSoundImpl=t})(volksoper||(volksoper={}));var volksoper;(function(e){var t=function(e){function t(t){var n=this;e.call(this,t),this._src=t,this._width=0,this._height=0;var r=document.createElement("img");r.onerror=function(){n._setError()},r.onload=function(){n._width=r.width,n._height=r.height,n._setUsable()},this._image=r,r.src=this._src}return __extends(t,e),t.prototype.width=function(){return this._width},t.prototype.height=function(){return this._height},t.prototype._getImage=function(){return this._image},t.prototype.render=function(){},t.prototype.invalidate=function(){},t.prototype.name=function(){return this._src},t}(e.ImageImpl);e.HTMLImageImpl=t})(volksoper||(volksoper={}));var volksoper;(function(e){var t=function(t){function n(e,n){t.call(this,e,n),this._parentDock=n}return __extends(n,t),n.prototype._newImageImpl=function(t){return new e.HTMLImageImpl(t)},n.prototype._newSoundImpl=function(t,n){return new(e.Platform.instance().getSoundImplClass())(t,n)},n}(e.SceneDock);e.HTMLSceneDock=t})(volksoper||(volksoper={}));var volksoper;(function(e){var t,n,r,i=function(){function n(){r=document.createElement("audio")}return Object.defineProperty(n.prototype,"prefix",{get:function(){return""},enumerable:!0,configurable:!0}),n.prototype.requestAnimationFrame=function(e,t){window[this.prefix+"RequestAnimationFrame"]?window[this.prefix+"RequestAnimationFrame"](e):window.setInterval(e,t)},n.instance=function(){if(!t){var r=navigator.userAgent;r.indexOf("Opera")>=0?t=new u:r.indexOf("MSIE")>=0?t=new a:r.indexOf("WebKit")>=0?t=new s:navigator.product==="Gecko"?t=new o:t=new n}return t},n.prototype.setTransformOrigin=function(e,t){e.style[this.prefix+"TransformOrigin"]=t},n.prototype.setTransform=function(e,t){e.style[this.prefix+"Transform"]=t},n.prototype.getSoundImplClass=function(){return e.DOMSoundImpl},n.prototype.getWebAudioContext=function(){return null},n.prototype.getPlayableSoundFormat=function(){return r.canPlayType("audio/mp3")?"mp3":r.canPlayType("audio/ogg")?"ogg":r.canPlayType("audio/wav")?"wav":null},n.prototype.isPlayableSoundFormat=function(t){return r.canPlayType("audio/"+e.extractExt(t))},n.prototype.canUseXHR=function(){return location.protocol!=="file:"},n.prototype.isMobile=function(){return navigator.userAgent.indexOf("Mobile")>=0},n}();e.Platform=i;var s=function(t){function r(){t.apply(this,arguments)}return __extends(r,t),Object.defineProperty(r.prototype,"prefix",{get:function(){return"webkit"},enumerable:!0,configurable:!0}),r.prototype.getWebAudioContext=function(){return n||(n=new window.webkitAudioContext),n},r.prototype.getSoundImplClass=function(){return this.canUseXHR()&&this.isMobile()?e.WebAudioSoundImpl:e.DOMSoundImpl},r}(i),o=function(e){function t(){e.apply(this,arguments)}return __extends(t,e),Object.defineProperty(t.prototype,"prefix",{get:function(){return"moz"},enumerable:!0,configurable:!0}),t}(i),u=function(e){function t(){e.apply(this,arguments)}return __extends(t,e),Object.defineProperty(t.prototype,"prefix",{get:function(){return"o"},enumerable:!0,configurable:!0}),t}(i),a=function(e){function t(){e.apply(this,arguments)}return __extends(t,e),Object.defineProperty(t.prototype,"prefix",{get:function(){return"ms"},enumerable:!0,configurable:!0}),t}(i)})(volksoper||(volksoper={}));var volksoper;(function(e){var t=function(t){function n(n){var r=this;t.call(this,n),this._mouseId=0,this._platform=e.Platform.instance(),this._adjusting=!1;var i=n.stageId||"volksoper-stage",s=document.getElementById(i);s||(s=document.createElement("div"),s.id=i,document.body.appendChild(s)),s.style.overflow="hidden";var o=window.getComputedStyle(s,""),u=parseInt(o.width),a=parseInt(o.height);u&&a?this.scale=Math.min(u/this.width,a/this.height):(s.style.width=this.width+"px",s.style.height=this.height+"px"),this._element=s,this._initListeners(),this._adjustStage(),window.onscroll=function(e){r._adjustStage(),r.render()},window.onresize=function(){r._adjustStage(),r.render()},this.invalidate()}return __extends(n,t),n.USE_DEFAULT=["input","textarea","select","area"],Object.defineProperty(n.prototype,"pageX",{get:function(){return this._pageX},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"pageY",{get:function(){return this._pageY},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"element",{get:function(){return this._element},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"platform",{get:function(){return this._platform},enumerable:!0,configurable:!0}),n.prototype._adjustCanvas=function(){},n.prototype._adjustStage=function(){if(!this._adjusting&&this._element){this._adjusting=!0,this.fullScreen&&(document.body.style.margin="0px",document.body.style.padding="0px",document.body.style.height="100%",document.body.style.width="100%",this.autoScale?this.scale=Math.min(window.innerWidth/this.width,window.innerHeight/this.height):this.autoSize&&(this.scale=1,this.width=window.innerWidth,this.height=window.innerHeight)),this._element.style.width=Math.round(this.scale*this.width)+"px",this._element.style.height=Math.round(this.scale*this.height)+"px",this._element.style.margin="auto auto",this._adjustCanvas();var e=this._element.getBoundingClientRect();this._pageX=window.scrollX+e.left||window.pageXOffset+e.left,this._pageY=window.scrollY+e.top||window.pageYOffset+e.top,this._adjusting=!1}},n.prototype._initListeners=function(){var t=this,r=this._element;document.addEventListener("keydown",function(n){t.keys[n.keyCode]&&(n.preventDefault(),n.stopPropagation()),t.running&&t.broadcastKeyEvent(e.KeyEvent.KEY_DOWN,n.keyCode,t.keys[n.keyCode]),t.invalidate()},!0),document.addEventListener("keyup",function(n){t.running&&t.broadcastKeyEvent(e.KeyEvent.KEY_UP,n.keyCode,t.keys[n.keyCode]),t.invalidate()},!0);var i=function(e){var r=e.target.tagName.toLowerCase();n.USE_DEFAULT.indexOf(r)<0&&(e.preventDefault(),t.running||e.stopPropagation())};r.addEventListener("touchstart",i,!0),r.addEventListener("touchmove",i,!0),r.addEventListener("touchend",i,!0),r.addEventListener("touchcancel",i,!0);var s=function(e){return function(r){var i=r.target.tagName.toLowerCase();n.USE_DEFAULT.indexOf(i)<0&&(e&&t._mouseId++,r.preventDefault(),t.running||r.stopPropagation())}};r.addEventListener("mousedown",s(!0),!0),r.addEventListener("mouseup",s(!1),!0),r.addEventListener("mousemove",s(!1),!0);var o=function(e,n,r){return function(i){var s=i.changedTouches,o=s.length;for(var u=0;u<o;u++){var a=s[u],f=a.identifier,l=(a.pageX-t._pageX)/t.scale,c=(a.pageY-t._pageY)/t.scale,h=t.propagateTouchEvent(e,l,c,f);n&&t.registerTouchReceiver(h,f),r&&t.unregisterTouchReceiver(f)}t.invalidate()}};r.addEventListener("touchstart",o(e.TouchEvent.TOUCH_START,!0,!1),!1),r.addEventListener("touchend",o(e.TouchEvent.TOUCH_END,!1,!0),!1),r.addEventListener("touchmove",o(e.TouchEvent.TOUCH_MOVE,!1,!1),!1),r.addEventListener("touchcancel",o(e.TouchEvent.TOUCH_CANCEL,!1,!0),!1);var u=!1;r.addEventListener("mousedown",function(n){var r=(n.pageX-t._pageX)/t.scale,i=(n.pageY-t._pageY)/t.scale,s=t._mouseId;u=!0;var o=t.propagateTouchEvent(e.TouchEvent.TOUCH_START,r,i,s);t.registerTouchReceiver(o,s),t.invalidate()},!1),document.addEventListener("mouseup",function(n){var r=(n.pageX-t._pageX)/t.scale,i=(n.pageY-t._pageY)/t.scale,s=t._mouseId;u=!1,t.propagateTouchEvent(e.TouchEvent.TOUCH_END,r,i,s),t.unregisterTouchReceiver(s),t.invalidate()},!1),r.addEventListener("mousemove",function(n){var r=(n.pageX-t._pageX)/t.scale,i=(n.pageY-t._pageY)/t.scale,s=t._mouseId;u&&t.propagateTouchEvent(e.TouchEvent.TOUCH_MOVE,r,i,s),t.invalidate()},!1)},n.prototype._createSceneDock=function(){var t=this.numChildren!==0?this.currentScene.dock:null;return new e.HTMLSceneDock(this,t)},n.prototype._nextFrame=function(e,t){this._platform.requestAnimationFrame(e,t)},n}(e.Stage);e.HTMLStage=t})(volksoper||(volksoper={}));var volksoper;(function(e){var t=function(t){function n(n,r){var i=this;t.call(this,n),this._src=n,this._autoPlay=!1,this._pause=!1,this._loop=!1;var s=e.Platform.instance(),o=s.getWebAudioContext(),u=new XMLHttpRequest,a=null;if(n.slice(n.length-3)==="snd"){var f=n.slice(0,n.length-4),l=s.getPlayableSoundFormat();a=f+l}else a=n;u.responseType="arraybuffer",u.open("GET",a,!0),u.onload=function(){o.decodeAudioData(u.response,function(e){i._buffer=e,i._setUsable(),(r||i._autoPlay)&&i.play()},function(e){i._setError()})},u.send(null)}return __extends(n,t),n.prototype.play=function(){if(this._buffer){var t=e.Platform.instance().getWebAudioContext();this._pause?this._bufferSrc.connect(t.destination):(this._bufferSrc&&this._bufferSrc.disconnect(t.destination),this._bufferSrc=t.createBufferSource(),this._bufferSrc.buffer=this._buffer,this._bufferSrc.connect(t.destination),this._bufferSrc.loop=this._loop,this._bufferSrc.noteOn(0))}else this._autoPlay=!0},n.prototype.pause=function(){if(this._bufferSrc){var t=e.Platform.instance().getWebAudioContext();this._bufferSrc.disconnect(t.destination),this._pause=!0}else this._autoPlay=!1},n.prototype.stop=function(){this._bufferSrc?this._bufferSrc.noteOff(0):this._autoPlay=!1},n.prototype.loop=function(e){this._bufferSrc?this._bufferSrc.loop=e:this._loop=e},n.prototype.release=function(){var e=t.prototype.release.call(this);return e<=0&&this._bufferSrc&&this._bufferSrc.disconnect(),e},n.prototype.name=function(){return this._src},n}(e.SoundImpl);e.WebAudioSoundImpl=t})(volksoper||(volksoper={}));var volksoper;(function(e){var t=function(e){function t(t,n){e.call(this,t),this._stage=n}return __extends(t,e),t.prototype.render=function(){this._stage.context.drawImage(this._getImage(),0,0)},t}(e.HTMLImageImpl);e.CanvasImageImpl=t})(volksoper||(volksoper={}));var volksoper;(function(e){var t=function(t){function n(e,n,r,i){t.call(this,r,"label"),this._width=e,this._height=n,this._name=r,this._context=i,this._lines=[],this._lineWidth=[],this._text="",this._align=0,this._lineGap=0}return __extends(n,t),n.prototype.text=function(e){this._text=e,this._measureText(),this._measureHeight()},n.prototype.align=function(e){this._align=e},n.prototype.lineGap=function(e){this._lineGap=e,this._measureHeight()},n.prototype.font=function(e){this._font="",e.italic&&(this._font+="italic "),e.bold&&(this._font+="bold "),e.size?(this._font+=e.size+"px ",this._fontSize=e.size):(this._font+="14px ",this._fontSize=14),e.face?this._font+=e.face+" ":this._font+="serif ",this._measureText(),this._measureHeight()},n.prototype.textColor=function(t){this._color=e.toCSSColor(t)},n.prototype._measureHeight=function(){var e=this._lines.length;e===0?this._totalHeight=0:this._totalHeight=e*this._fontSize+(e-1)*this._lineGap},n.prototype._measureText=function(){var e=this._text.replace(/\r\n/,"\n").split("\n");this._lines=[],this._lineWidth=[],this._context.font=this._font;for(var t=0,n=e.length;t<n;++t)this._pushLine(e[t])},n.prototype._pushLine=function(e){var t="",n="",r=0;for(var i=0,s=e.length;i<s;++i){n+=e.charAt(i);if((r=this._context.measureText(n).width)>this._width){if(n.length===1)return;this._lines.push(t),this._lineWidth.push(r),i-=1,t="",n=""}else t=n}t.length>0&&(this._lines.push(t),this._lineWidth.push(r))},n.prototype.width=function(){return this._width},n.prototype.height=function(){return this._height},n.prototype.name=function(){return this._name},n.prototype.render=function(){var t=0,n=0,r=this._align;(r&e.VerticalAlign.CENTER)!==0?n=(this._height-this._totalHeight)/2:(r&e.VerticalAlign.BOTTOM)!==0&&(n=this._height-this._totalHeight),this._context.font=this._font,this._context.fillStyle=this._color,this._context.textBaseline="top";for(var i=0,s=this._lines.length;i<s;++i)(r&e.HorizontalAlign.CENTER)!==0?t=(this._width-this._lineWidth[i])/2:(r&e.HorizontalAlign.RIGHT)!==0?t=this._width-this._lineWidth[i]:t=0,this._context.fillText(this._lines[i],t,n),n+=this._fontSize+this._lineGap},n}(e.LabelImpl);e.CanvasLabelImpl=t})(volksoper||(volksoper={}));var volksoper;(function(e){var t=function(e){function t(t,n){e.call(this),this._context=t,this._alphaStack=n}return __extends(t,e),t.prototype.visitDisplayObject=function(e){var t=e.localMatrix.m,n=this._alphaStack.length,r=n===0?e.alpha:this._alphaStack[n-1]*e.alpha;this._alphaStack.push(r),this._context.save(),this._context.globalAlpha=r,this._context.transform(t[0],t[4],t[1],t[5],t[12],t[13])},t}(e.RenderingVisitor);e.PreCanvasRenderingVisitor=t;var n=function(e){function t(t){e.call(this),this._context=t}return __extends(t,e),t.prototype.visitSprite=function(e){e.surface&&e.surface._render()},t}(e.RenderingVisitor);e.ProcessCanvasRenderingVisitor=n;var r=function(e){function t(t,n){e.call(this),this._context=t,this._alphaStack=n}return __extends(t,e),t.prototype.visitDisplayObject=function(e){this._context.restore(),this._alphaStack.pop()},t}(e.RenderingVisitor);e.PostCanvasRenderingVisitor=r})(volksoper||(volksoper={}));var volksoper;(function(e){var t=function(t){function n(){t.apply(this,arguments)}return __extends(n,t),n.prototype._newImageImpl=function(t){return new e.CanvasImageImpl(t,this.stage)},n.prototype._newSurfaceImpl=function(t,n,r,i,s){return new e.CanvasSurfaceImpl(t,n,r,i,s,this.stage)},n.prototype._newLabelImpl=function(t,n,r){return new e.CanvasLabelImpl(t,n,r,this.stage.context)},n}(e.HTMLSceneDock);e.CanvasSceneDock=t})(volksoper||(volksoper={}));var volksoper;(function(e){var t=function(e){function t(t,n,r,i,s,o){e.call(this,s,"surface"),this._width=t,this._height=n,this._renderer=r,this._primitive=i,this._name=s,this._stage=o;if(!i){var u=document.createElement("canvas");u.style.width=this._width+"px",u.style.height=this._height+"px",u.style.position="absolute",this._element=u,this._context=u.getContext("2d")}}return __extends(t,e),t.prototype.width=function(){return this._width},t.prototype.height=function(){return this._height},t.prototype.name=function(){return this._name},t.prototype.invalidate=function(){this._primitive||this._stage._addDirtySurfaceImpl(this)},t.prototype.render=function(){this._primitive?this._renderer(this,this._stage.context):this._stage.context.drawImage(this._element,0,0)},t.prototype.renderContent=function(){this._renderer(this,this._context)},t}(e.SurfaceImpl);e.CanvasSurfaceImpl=t})(volksoper||(volksoper={}));var volksoper;(function(e){var t=function(t){function n(e){t.call(this,e),this._dirty=[]}return __extends(n,t),Object.defineProperty(n.prototype,"fps",{get:function(){return this._fps},set:function(e){this._fps=e},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"context",{get:function(){return this._context},enumerable:!0,configurable:!0}),n.prototype._adjustCanvas=function(){var t=this._canvas;if(!t){t=document.createElement("canvas"),this.element.appendChild(t),this._canvas=t;var n=t.getContext("2d"),r=[];this._pre=new e.PreCanvasRenderingVisitor(n,r),this._process=new e.ProcessCanvasRenderingVisitor(n),this._post=new e.PostCanvasRenderingVisitor(n,r),this._context=n}t.width=this.width,t.height=this.height,this.platform.setTransformOrigin(t,"0 0"),this.platform.setTransform(t,"scale("+this.scale+")")},n.prototype.render=function(){this.invalidateSurfaceImpl(),this.context.fillStyle=e.toCSSColor(this.backgroundColor),this.context.fillRect(0,0,this.width,this.height),this._render(this._pre,this._process,this._post)},n.prototype.invalidateSurfaceImpl=function(){if(this._dirty.length>=0){var e=this._dirty.length;for(var t=0;t<e;++t)this._dirty[t].renderContent();this._dirty.splice(0)}},n.prototype._addDirtySurfaceImpl=function(e){this._dirty.push(e)},n.prototype._createSceneDock=function(){var t=this.numChildren!==0?this.currentScene.dock:null;return new e.CanvasSceneDock(this,t)},n}(e.HTMLStage);e.CanvasStage=t})(volksoper||(volksoper={})),volksoper._registerEngine("canvas",volksoper.CanvasStage);